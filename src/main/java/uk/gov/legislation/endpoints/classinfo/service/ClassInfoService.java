package uk.gov.legislation.endpoints.classinfo.service;import org.springframework.stereotype.Service;import uk.gov.legislation.data.virtuoso.JsonResults;import uk.gov.legislation.data.virtuoso.Virtuoso;import uk.gov.legislation.data.virtuoso.model.Resources;import java.io.IOException;import java.util.*;@Servicepublic class ClassInfoService {    private final Virtuoso virtuoso;    public ClassInfoService(Virtuoso virtuoso) {        this.virtuoso = virtuoso;    }    public Map<String, List<Object>> retrieveClassDataAsJson(String type) throws IOException, InterruptedException {        JsonResults json = executeRdfQuery(type);        if (json.results.bindings.isEmpty()) {            return Collections.emptyMap();        }        return convertRdfToJson(json);    }    private JsonResults executeRdfQuery(String type) throws IOException, InterruptedException {        String query = """                SELECT ?p ?o                WHERE {                   BIND(<%s%s> AS ?s)                   ?s ?p ?o                }            """.formatted(Resources.Leg.Prefix, type);        return virtuoso.query(query);    }    private static Map<String, List<Object>> convertRdfToJson(JsonResults json) {        Map<String, List<Object>> resultMap = new HashMap<>();        for (Map<String, JsonResults.Value> binding : json.results.bindings) {            if (!binding.containsKey("p") || !binding.containsKey("o")) {                continue;            }            String predicate = binding.get("p").value;            String object = binding.get("o").value;            /// Store properties dynamically in a list to handle multiple values            resultMap.computeIfAbsent(predicate, k -> new ArrayList<>()).add(object);        }        return resultMap;    }}